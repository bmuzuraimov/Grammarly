var myDoc, sentences, words, startPosition, endPosition, promtWords, endMarks, isrequest = !0,
    lastLength = 0;

function key_events(e, i) {
    $("#mydocument").keydown(t => {
        (t.keyCode || t.which) === e && (t.preventDefault(), window[i]())
    })
}

function check_promtWords() {
    post_request("/promtwords", words, "suggest_promtWords")
}

function suggest_promtWords(t) {
    $(".word-promt__words").empty(), $.each(t, (t, e) => {
        $(".word-promt__words").append('<li><a href="#">${item.word}</a></li>')
    })
}

function check_question_mark() {
    post_request("/isquestionmark", sentences = myDoc.split(/([\\.!?])/g), "suggest_end_marks")
}

function suggest_end_marks(t) {
    $(".mistakes__table").empty(), $.each(t.fixes, (t, e) => {
        $(".mistakes__table").append('<li><a href="#">Тыныш белги: ${item[2]}</a></li>'), applyHighlights(e[1])
    })
}

function post_request(t, e, i) {
    isrequest = !1, lastLength = myDoc.length, e = JSON.stringify(e), setTimeout(() => {
        isrequest = !0
    }, 3e3), $.post(t, {
        data: e
    }, t => {
        t = JSON.parse(t), window[i](t)
    })
}

function applyHighlights(t) {
    var e = new RegExp("${mark}"),
        e = myDoc.replace(e, "<mark>${mark}</mark>");
    $("#mypage").html(e)
}

function animateLoading(t) {
    t ? ($(".loading-title").removeClass("hidden"), $(".lds-ellipsis div:nth-child(1)").addClass("loading-animate-1"), $(".lds-ellipsis div:nth-child(2)").addClass("loading-animate-2"), $(".lds-ellipsis div:nth-child(3)").addClass("loading-animate-3"), $(".lds-ellipsis div:nth-child(4)").addClass("loading-animate-4")) : ($(".loading-title").addClass("hidden"), $(".lds-ellipsis div:nth-child(1)").removeClass("loading-animate-1"), $(".lds-ellipsis div:nth-child(2)").removeClass("loading-animate-2"), $(".lds-ellipsis div:nth-child(3)").removeClass("loading-animate-3"), $(".lds-ellipsis div:nth-child(4)").removeClass("loading-animate-4"))
}
$(".doc-title").change(() => {
    var t = $(".doc-title").val();
    $("#webpage-title").html(t)
}), $("#mydocument").click(function() {
    startPosition = this.selectionStart, endPosition = this.selectionEnd, startPosition == endPosition ? console.log("The position of the cursor is (${startPosition}/${$(this).val().length})") : console.log("Selected text from (${startPosition} to ${endPosition} of ${$(this).val().length})")
}), $("#mydocument").on("input", () => {
    myDoc = $("#mydocument").val(), $("#mypage").html(myDoc), words = $("#mydocument").val().split(/([, ])/g), animateLoading(!0), isrequest && 1 < words.length && (check_question_mark(myDoc), animateLoading(!1)), 0 == $("#mydocument").val().length && ($(".word-promt__words").empty(), animateLoading(!1)), 0 < words[words.length - 1].length && check_promtWords()
}), window.setInterval(() => {
    myDoc = $("#mydocument").val(), animateLoading(!1), 0 < myDoc.length && lastLength != myDoc.length && check_question_mark()
}, 5e3);